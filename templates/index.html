<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Calculadora por Voz Web</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Calculadora por Voz</h1>

    <label>Escribe o di una operación:</label><br>
    <input type="text" id="expresion" placeholder="Ej: cinco más seis" /><br><br>

    <button type="button" onclick="reconocerVoz()">🎤 Hablar</button>
    <button type="button" onclick="calcular()">Calcular</button><br><br>

    <div id="resultado"></div>

    <script>
        // Reconocimiento de voz
        function reconocerVoz() {
            const reconocimiento = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            reconocimiento.lang = 'es-ES';

            reconocimiento.onresult = function(event) {
                const expresion = event.results[0][0].transcript;
                document.getElementById("expresion").value = expresion;

                if (expresion.toLowerCase().includes("calcular")) {
                    calcular();
                }
            };

            reconocimiento.onerror = function(event) {
                console.error("Error de reconocimiento de voz:", event.error);
                hablar("Ocurrió un error al reconocer tu voz");
            };

            reconocimiento.start();
        }

        // Función para evaluar la expresión y hablar el resultado
        function calcular() {
            const expresion = document.getElementById("expresion").value;

            // Reemplazo palabras por símbolos
            const operaciones = {
                'más': '+',
                'menos': '-',
                'por': '*',
                'entre': '/',
            };

            let expresionMatematica = expresion.toLowerCase();
            for (let palabra in operaciones) {
                const regex = new RegExp(palabra, 'g');
                expresionMatematica = expresionMatematica.replace(regex, operaciones[palabra]);
            }

            try {
                const resultado = eval(expresionMatematica);
                document.getElementById("resultado").innerText = `Resultado: ${resultado}`;
                hablar(`El resultado es ${resultado}`);
            } catch (error) {
                console.error("Error al calcular:", error);
                document.getElementById("resultado").innerText = "Ocurrió un error al calcular.";
                hablar("Ocurrió un error al calcular");
            }
        }

        // Síntesis de voz
        function hablar(texto) {
            const mensaje = new SpeechSynthesisUtterance();
            mensaje.lang = "es-ES";
            mensaje.text = texto;
            window.speechSynthesis.speak(mensaje);
        }
    </script>
</body>
</html>
